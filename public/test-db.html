<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Connection Check</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0e27;
            color: white;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }

        h1 {
            margin-bottom: 2rem;
            background: linear-gradient(to right, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .success {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
        }

        .error {
            background: rgba(252, 103, 103, 0.2);
            color: #fc6767;
        }

        .loading {
            color: #aaa;
        }
    </style>
</head>

<body>
    <h1>üîç Database Diagnostic</h1>

    <div class="card">
        <h3>Connection Status</h3>
        <div id="results">
            <div class="item">Checking Tables...</div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        // Load env vars manually/hardcoded for this standalone test file since it's in public
        // Note: In real app we use import.meta.env but here we are in a raw HTML file served by Vite
        // We will try to grab them from window if injected, or use the ones you provided.

        const SUPABASE_URL = 'https://nsyndnagwrfzgyifriak.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zeW5kbmFnd3Jmemd5aWZyaWFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NjA1MzYsImV4cCI6MjA4MTIzNjUzNn0.j43-cO1RoxaY4q5jK8OXTyxEXhJxGA_ptyXfkwdd0vo';

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        const tables = ['users', 'customers', 'attendance', 'orders'];
        const resultsDiv = document.getElementById('results');

        async function checkTables() {
            resultsDiv.innerHTML = '';

            for (const table of tables) {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<span>Table: <strong>${table}</strong></span> <span class="status loading">Checking...</span>`;
                resultsDiv.appendChild(div);

                try {
                    // Try to select just one item, minimal data transfer
                    // We use count because it's lighter
                    const { count, error } = await supabase
                        .from(table)
                        .select('*', { count: 'exact', head: true });

                    if (error) {
                        // Check specifically for "relation does not exist" which means table is missing
                        if (error.code === '42P01') {
                            throw new Error('Table does not exist');
                        }

                        // If permission denied (42501), table exists but RLS blocks it. This is technically a success for "table existence check"
                        if (error.code === '42501') {
                            updateStatus(div, 'Exists (RLS Protected)', 'success');
                            continue;
                        }

                        throw error;
                    }

                    updateStatus(div, `Active (Rows: ${count ?? 0})`, 'success');

                } catch (err) {
                    console.error(err);
                    updateStatus(div, err.message || 'Error', 'error');
                }
            }
        }

        function updateStatus(element, text, classes) {
            const span = element.querySelector('.status');
            span.textContent = text;
            span.className = `status ${classes}`;
        }

        checkTables();
    </script>
</body>

</html>